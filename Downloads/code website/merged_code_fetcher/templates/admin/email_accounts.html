{% extends "admin/base.html" %}

{% block title %}Email Accounts Management{% endblock %}

{% block content %}
<div class="content-header" style="color: #1e293b; margin-bottom: 2rem;">
    <div>
        <h1 class="page-title" style="color: #1e293b; font-size: 2rem; font-weight: 700; margin: 0;">Email Accounts Management</h1>
        <p class="page-subtitle" style="color: #64748b; font-size: 1rem; margin: 0.5rem 0 0 0;">Manage email accounts for fetching verification codes</p>
    </div>
    <div class="header-actions">
        <button onclick="showAddForm()" class="btn btn-primary" style="background: #3b82f6; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer;">
            <i class="fas fa-plus"></i> Add Email Account
        </button>
    </div>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            {% if category == 'success' %}
                <div class="toast success" style="position: relative; margin-bottom: 1rem; background: white; border-radius: 8px; padding: 1rem 1.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-left: 4px solid #10b981; color: #1e293b;">
                    {{ message }}
                </div>
            {% else %}
                <div class="toast error" style="position: relative; margin-bottom: 1rem; background: white; border-radius: 8px; padding: 1rem 1.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-left: 4px solid #ef4444; color: #1e293b;">
                    {{ message }}
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
{% endwith %}

<!-- Add New Email Account Form -->
<div id="addEmailForm" class="card" style="margin-bottom: 2rem; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); border: 1px solid #e2e8f0;">
    <div class="card-header" style="padding: 1.5rem; border-bottom: 1px solid #e2e8f0; background: #f8fafc; border-radius: 12px 12px 0 0;">
        <h2 class="card-title" style="color: #1e293b; font-size: 1.25rem; font-weight: 600; margin: 0;">
            <i class="fas fa-plus-circle" style="color: #3b82f6; margin-right: 0.5rem;"></i>
            Add New Email Account
        </h2>
    </div>
    <div class="card-body" style="padding: 1.5rem;">
        <form method="POST" action="{{ url_for('admin.add_email_account') }}">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div class="form-group">
                    <label for="email" class="form-label" style="display: block; color: #374151; font-weight: 500; margin-bottom: 0.5rem;">Email Address</label>
                    <input type="email" id="email" name="email" class="form-input" 
                           style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 1rem; color: #1f2937; background: white;"
                           placeholder="example@domain.com" required>
                </div>
                <div class="form-group">
                    <label for="password" class="form-label" style="display: block; color: #374151; font-weight: 500; margin-bottom: 0.5rem;">Password</label>
                    <input type="password" id="password" name="password" class="form-input" 
                           style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 1rem; color: #1f2937; background: white;"
                           placeholder="Email password" required>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr auto auto; gap: 1rem; align-items: end;">
                <div class="form-group">
                    <label for="provider" class="form-label" style="display: block; color: #374151; font-weight: 500; margin-bottom: 0.5rem;">Email Provider</label>
                    <select id="provider" name="provider" class="form-select" 
                            style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.5rem; font-size: 1rem; color: #1f2937; background: white;" required>
                        <option value="">Select Provider</option>
                        <option value="outlook">Outlook/Hotmail</option>
                        <option value="gmail">Gmail</option>
                        <option value="hostinger">Hostinger Mail</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="background: #10b981; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer;">
                        <i class="fas fa-plus"></i> Add Account
                    </button>
                </div>
                <div class="form-group">
                    <button type="button" onclick="hideAddForm()" class="btn btn-secondary" style="background: #6b7280; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Email Accounts List -->
<div class="table-container" style="background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); border: 1px solid #e2e8f0; overflow: hidden;">
    <div style="padding: 1.5rem; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
        <h3 style="margin: 0; font-size: 1.1rem; font-weight: 600; color: #1e293b;">
            <i class="fas fa-envelope" style="margin-right: 0.5rem; color: #667eea;"></i>
            Configured Email Accounts
        </h3>
        <p style="margin: 0.5rem 0 0 0; color: #64748b; font-size: 0.9rem;">
            Manage your email accounts for fetching verification codes
        </p>
    </div>
    
    <table class="table" style="width: 100%; border-collapse: collapse;">
        <thead style="background: #f1f5f9;">
            <tr>
                <th style="padding: 1rem; text-align: left; color: #374151; font-weight: 600; border-bottom: 1px solid #e2e8f0;">
                    <i class="fas fa-envelope" style="margin-right: 0.5rem; color: #3b82f6;"></i>Email Address
                </th>
                <th style="padding: 1rem; text-align: left; color: #374151; font-weight: 600; border-bottom: 1px solid #e2e8f0;">
                    <i class="fas fa-server" style="margin-right: 0.5rem; color: #3b82f6;"></i>Provider
                </th>
                <th style="padding: 1rem; text-align: left; color: #374151; font-weight: 600; border-bottom: 1px solid #e2e8f0;">
                    <i class="fas fa-toggle-on" style="margin-right: 0.5rem; color: #3b82f6;"></i>Status
                </th>
                <th style="padding: 1rem; text-align: left; color: #374151; font-weight: 600; border-bottom: 1px solid #e2e8f0;">
                    <i class="fas fa-calendar" style="margin-right: 0.5rem; color: #3b82f6;"></i>Created
                </th>
                <th style="padding: 1rem; text-align: left; color: #374151; font-weight: 600; border-bottom: 1px solid #e2e8f0;">
                    <i class="fas fa-clock" style="margin-right: 0.5rem; color: #3b82f6;"></i>Last Used
                </th>
                <th style="padding: 1rem; text-align: left; color: #374151; font-weight: 600; border-bottom: 1px solid #e2e8f0;">
                    <i class="fas fa-cogs" style="margin-right: 0.5rem; color: #3b82f6;"></i>Actions
                </th>
            </tr>
        </thead>
        <tbody>
            {% for account in email_accounts %}
            <tr style="border-bottom: 1px solid #f1f5f9;">
                <td style="padding: 1rem; color: #1f2937;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-at" style="color: #667eea;"></i>
                        <strong>{{ account.email }}</strong>
                    </div>
                </td>
                <td style="padding: 1rem; color: #1f2937;">
                    <span class="badge badge-info" style="background: #dbeafe; color: #1e40af; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; text-transform: uppercase;">
                        {% if account.provider == 'outlook' %}
                            <i class="fas fa-microsoft" style="margin-right: 0.25rem;"></i>
                        {% elif account.provider == 'gmail' %}
                            <i class="fas fa-google" style="margin-right: 0.25rem;"></i>
                        {% else %}
                            <i class="fas fa-server" style="margin-right: 0.25rem;"></i>
                        {% endif %}
                        {{ account.provider }}
                    </span>
                </td>
                <td style="padding: 1rem; color: #1f2937;">
                    {% if account.is_active %}
                        <span class="badge badge-success" style="background: #dcfce7; color: #166534; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500;">
                            <i class="fas fa-check-circle" style="margin-right: 0.25rem;"></i>
                            Active
                        </span>
                    {% else %}
                        <span class="badge badge-danger" style="background: #fef2f2; color: #dc2626; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500;">
                            <i class="fas fa-times-circle" style="margin-right: 0.25rem;"></i>
                            Inactive
                        </span>
                    {% endif %}
                </td>
                <td style="padding: 1rem; color: #1f2937;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-calendar-plus" style="color: #64748b;"></i>
                        {{ account.created_at.strftime('%Y-%m-%d %H:%M') }}
                    </div>
                </td>
                <td style="padding: 1rem; color: #1f2937;">
                    {% if account.last_used %}
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-history" style="color: #10b981;"></i>
                            {{ account.last_used.strftime('%Y-%m-%d %H:%M') }}
                        </div>
                    {% else %}
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-minus-circle" style="color: #64748b;"></i>
                            <span style="color: #64748b;">Never</span>
                        </div>
                    {% endif %}
                </td>
                <td style="padding: 1rem; color: #1f2937;">
                    <div style="display: flex; gap: 0.5rem;">
                        <form method="POST" action="{{ url_for('admin.toggle_email_account', account_id=account.id) }}" style="display: inline;">
                            {% if account.is_active %}
                                <button type="submit" class="btn btn-sm btn-secondary" 
                                        style="background: #6b7280; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.375rem; font-size: 0.875rem; cursor: pointer;"
                                        title="Deactivate account">
                                    <i class="fas fa-pause"></i>
                                    Deactivate
                                </button>
                            {% else %}
                                <button type="submit" class="btn btn-sm btn-success" 
                                        style="background: #10b981; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.375rem; font-size: 0.875rem; cursor: pointer;"
                                        title="Activate account">
                                    <i class="fas fa-play"></i>
                                    Activate
                                </button>
                            {% endif %}
                        </form>
                        <form method="POST" action="{{ url_for('admin.delete_email_account', account_id=account.id) }}" 
                              style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this email account?')">
                            <button type="submit" class="btn btn-sm btn-danger" 
                                    style="background: #ef4444; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.375rem; font-size: 0.875rem; cursor: pointer;"
                                    title="Delete account">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" style="text-align: center; padding: 3rem; color: #64748b;">
                    <div>
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3; color: #9ca3af;"></i>
                        <h3 style="margin: 0 0 0.5rem 0; font-weight: 500; color: #374151;">No Email Accounts Configured</h3>
                        <p style="margin: 0; font-size: 0.9rem; color: #6b7280;">Add your first email account to start fetching verification codes.</p>
                        <button onclick="showAddForm()" class="btn btn-primary" style="margin-top: 1rem; background: #3b82f6; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer;">
                            <i class="fas fa-plus"></i> Add Your First Email Account
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function showAddForm() {
    document.getElementById('addEmailForm').style.display = 'block';
    document.getElementById('email').focus();
}

function hideAddForm() {
    document.getElementById('addEmailForm').style.display = 'none';
}
</script>

<style>
/* Additional visibility styles */
* {
    color: inherit !important;
}

/* Make inputs, selects, and textareas readable */
input,
select,
textarea {
    color: #1e293b !important;        /* Dark gray text */
    background: #ffffff !important;   /* Ensure background stays white */
}

/* Make placeholder text visible */
input::placeholder,
textarea::placeholder {
    color: #64748b !important;        /* Subtle gray for placeholder */
}

/* Style disabled/read-only inputs so they look different */
input:disabled,
textarea:disabled,
select:disabled {
    background: #f1f5f9 !important;   /* Light gray background */
    color: #9ca3af !important;        /* Lighter text */
}


.content-header h1,
.content-header p,
.card-title,
.form-label,
.table th,
.table td {
    color: #1e293b !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.btn {
    opacity: 1 !important;
    visibility: visible !important;
}

@media (max-width: 768px) {
    .card-body > form > div:first-child {
        grid-template-columns: 1fr !important;
    }
    
    .card-body > form > div:last-child {
        grid-template-columns: 1fr !important;
    }
    
    .table {
        font-size: 0.875rem;
    }
    
    .table th, .table td {
        padding: 0.5rem;
    }
}
</style>
{% endblock %}
